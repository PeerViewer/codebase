<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⇔ PeerViewer</title>
  </head>
  <body>
    <div class="container">
        <header>
	   <p class="logo">⇔</p>
           <h1>PeerViewer</h1>
           <p>The free peer-to-peer TeamViewer solution.</p>
        </header>
        <div class="menu">
            <div class="menuitem"><button onclick="menuChange(0)">Remote</button></div>
            <div class="menuitem"><button onclick="menuChange(1)">More Features</button></div>
            <div class="menuitem"><button onclick="menuChange(2)">Live Support</button></div>
            <div class="menuitem"><button onclick="menuChange(3)">Contact</button></div>
            <div class="menuitem"><button onclick="menuChange(4)">Donate</button></div>
            <div class="menuitem"><button onclick="menuChange(5)">About</button></div>
        </div>
        <div class="main-content" id="content0">
            <div class="column" id="column1">
                <h2>Allow Remote Control</h2>
                <!-- <button class="bluebutton" onclick="runServer()">Run Server</button> -->
		<p id="youridlabel">YOUR ID:</p>
                <div id="pubkey"></div>
		<div id="serverhelptext">When you give your ID to someone running PeerViewer, they can operate your computer until you close this window.</div>
		<div id="serverstatus">Initializing...</div>
            </div>
            <div class="column" id="column2">
                <h2>Control Remote Computer</h2>
		<p>
                <label for="connectto">Partner ID:</label>
                <input type="text" id="connectto" name="connectto"/>
		</p>
                <button class="bluebutton" onclick="runClient()">CONNECT</button>
		<div id="clientstatus">Ready to connect.</div>
            </div>
        </div>
        <div class="main-content" id="content1">
		<h2>More Features</h2>
		<p>Which feature would you like to see implemented next? Vote with your wallet!</p>
	</div>
        <div class="main-content" id="content2">
		<h2>Live Support</h2>
	</div>
        <div class="main-content" id="content3">
		<h2>Contact</h2>
	</div>
        <div class="main-content" id="content4">
		<h2>Donate</h2>
	</div>
        <div class="main-content" id="content5">
		<div class="onecolumn">
		<h2>About</h2>
		<p>PeerViewer is a free for unlimited use TeamViewer solution.</p>
		<p>Under the hood, it uses direct (peer-to-peer) connections between the participants.</p>
		<p>This was recently made possible by the advanced holepunching techniques, made by the <a href="https://holepunch.to">HolePunch</a> company.</p>
		<h3>Why peer-to-peer?</h3>
		<p>Traditionally, when you use network apps such as TeamViewer, place audio and video calls or share files, your data is going through intermediate servers which are expensive to host, can harm your privacy, increase latency and consume additional bandwidth.</p>
		<p>Peer-to-peer solutions such as PeerViewer have the advantage of:
		<ul>
			<li>Being the highest bandwidth AND lowest latency way of establishing a network connection.</li>
			<li>Ensuring maximum privacy for all participants.</li>
			<li>Being low cost, making it possible to survive on a pay-what-you-can/voluntary/donation basis.</li>
			<li>Minimizing time-to-market and allowing for quick MVP's without a lot of server-side datacenter setup work.</li>
		</ul>
		</div>
	</div>
        <footer>
            <p>PeerViewer © 2023 - powered by HolePunch</p>
        </footer>
    </div>
    <script>
        const { ipcRenderer } = require('electron');
        function runServer() {
          ipcRenderer.send('run-server');
          console.log("run-server done");
        }
        function runClient() {
	  let connectto = document.getElementById('connectto').value;
	  if (connectto) {
            ipcRenderer.send('run-client', connectto);
	  } else {
            document.getElementById("clientstatus").innerHTML = "WARNING: issue with Partner ID, can't connect.";
          }
          console.log("run-client done");
        }
	function menuChange(itemnr) {
	  console.log("changing menu " + itemnr);
          for (let i=0;i<6;i++) {
            let tohide = document.getElementById("content" + i)
            if (tohide) tohide.style.display = "none";
          }
          let toshow = document.getElementById("content" + itemnr)
          if (toshow) toshow.style.display = "flex";
	}
        // Listen for the response from the main process
        ipcRenderer.on('run-client-result', (event, result) => {
          console.log("got result:" + result);
        });
        ipcRenderer.on('run-server-result', (event, result) => {
          console.log("got result:" + result);
        });
        ipcRenderer.on('run-server-pubkey', (event, result) => {
          console.log("run-server-pubkey: " + result);
          document.getElementById("pubkey").innerHTML = result;
        });
	ipcRenderer.on('run-server-log', (event, result) => {
          console.log("run-server-log: " + result);
          document.getElementById("serverstatus").innerHTML = result;
        });
	ipcRenderer.on('run-client-log', (event, result) => {
          console.log("run-client-log: " + result);
          document.getElementById("clientstatus").innerHTML = result;
        });

	// run server automatically
	runServer();
    </script>
  </body>
</html>
